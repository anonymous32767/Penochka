module wakaba {Вакаба}\
{Поддержка имиджбордов на базе этого движка}\
{

	kernel

	doc {Ничего необычного тут нет: простая реализация api. Некая особенность заключается лишь в довольно трудном процессе выковыривания 	  оп-постов (функция extractOppost()).}
	
	js {$.on(
      ['iichan.ru', '2-ch.ru', '02ch.su', '2ch.olanet.ru'],
      function () {
			$.on('ready',function () { 
				$.css('.penPreview {border: 2px dashed #EE6600;}')
				return true
			})

			function extractOppost (anchor) {
				return $.makeBox('Оп-пост')
			}

         $.extend({
            extractPost: function(id, doc) {
               var anchor = $('a[name="'+id+'"]:first', doc)
               if (!anchor.length)
                  return false
               var ret = anchor.closest('td')
               if (!ret.length)
                  return extractOppost()
               else
                  return ret
            },
            makeBox: function (text) {
               return $('<div class="reply">' + text + '</div>')
            },
				insertInFooter: function (a) {
					$('p.footer a:last').after(' + ' + a)
				}})

         $.extend(jQuery.ss, {
            refsep: '>>',
            cache: '#delform'
         })

			return true
      })}
}