<!doctype html>
<html>
<head>
  <title>posts &#8212; Post deliveri service</title>
  <link href="style.css" type="text/css" rel="stylesheet" />
</head>
<body>
<h1>posts &#8212; Post deliveri service</h1>
<p class="abstract">Получение сообщений по ссылке</p>
<p>Модуль обрабатывает события <tt>/r/ post</tt> и отсылает с ответ события   <tt>post ok</tt> с DOMом сообщения или <tt>fail</tt> с указанием того, что плохого произошло.</p><p>TODO: Описать подробнее про работу с кешем.</p>

<p><pre>$.on('/r/ post', function(data) {
      var addr = data.href.split('#')
      var extracted = $.extractPost(addr[1], data.ctx)
      if (extracted) {
         if (extracted.length) {
            data.data = extracted
            $.to('post ok', data)
         } else {
            data.wtf = 'Anchor found but post not extracted.'
            $.to('fail', data)
         }
      } else {
			if (data.senttocache) {
				data.wtf = 'Post not found in pointed url'
				return $.to('fail', data)
			} else {
				data.senttocache = 1
				return $.to('/r/ cache', data)
			}
      }
   })

	$.on(
		'cache ok',
		function (data) {
         if (data.preview) {
            data.ctx = data.data
            $.to('/r/ post', data)
         }
      })</pre></p>
</body></html>
